# Conventions

Our global conventions.

____
# Overall

### Ports numbering

We want to avoid conflicts between the ports used by our apps.
- Backend apps should listen on ports 5xxx
- Frontend apps should listen on ports 3xxx
- Listening port should be unique across all projects

____
# Infrastructure

### Logging

For both backend & frontend services: logs must be structured the same way everywhere and must be in compliance with to our specification:

We use **JSON** to format our logs.

All following sections are on same level of the JSON object, we just split them by section to explain what are their purposes.

### Adding more fields

Everytime a new field is required, we must check it does not fit into an existing one to keep consistency between different services.
Each new fields should be added in this documentation.

#### About the receiver:
*Information related to the machine/server/service receiving an instruction.*

```json
{
  "host": "172.0.0.1,198.0.0.1...",
  "service_name": "nginx,auth-backend,hydra,admin-frontend...",
  "service_version": "version of the service",
  "local_date": "UTC date in RFC3339 format: 2002-10-02T15:00:00.05Z",
}
```

**Mandatory fields:** `host`, `service_name`, `service_version`, `local_date`.

#### About the received request:
*Information related to received intruction.*

```json
{
  "request_id": "request unique identifier: anything unique generated by first interlocutor",
  "requester": "entity performing the request: app:uuid/service:name/user:uuid...",
  "protocol": "used communication protocol: http,gRPC...",
  "uri_path": "location of the request: /user-accounts,...",
  "method": "use method for the request: GET,POST...",
  "request_bytes": "size of the received body",
}
```

**Mandatory fields:** `request_id`, `requester`.

#### About the response:
*Information about the response done by the service.*

``` json
{
  "status": "response code",
  "response_bytes": "size of returned body",
  "response_time": "amount of time to process the request",
  "message": "free text",
}
```

**No mandatory fields.**

#### About the log itself:
*Information about the log.*

```json
{
  "severity": "level of the log: debug/info/critical...",
  "file": "file where the logging happened",
  "line_no": "the line where the logging happened",
  "stack_trace": "free text about the stack trace of the program",
}
```

**Mandatory fields:**: `severity`, `file`, `no_line`.

____
# Backend

## API Format

For each API that don't need to follow a specific standard (like OAuth for the authentication), we aim to implement resource-oriented apis.

We target to be RESTful but we could make some exceptions according to our needs. Exceptions must be discussed and agreed between maintainers to ensure APIs can evolve decently, and so architecture and product.

You can read about resource-oriented good pratices in the [Google API Design Guide](https://cloud.google.com/apis/design/).

## Emailing

All email we send should follow email's RFC.
Particulary we should implement an HTML and a plain text version of the content

## Internationalization (I18N)

Most of the I18N should be done in frontend. So the backend will send to frontend translation labels.
For the few cases that are not working in frontend (like sending emails), the I18N should be possible too (and as much as possible the language should be defined by the frontend).

____
# Frontend

We use I18Next as a frontend I18N framework. \o/
